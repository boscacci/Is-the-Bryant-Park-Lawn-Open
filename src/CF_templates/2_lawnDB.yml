Description: >
  RDS SQL DB cfg; contains scraped lawn open/closed data

Resources:
  lawnDB: # Central DB. Use sidecar stack policy to avoid overwrites
    Type: AWS::RDS::DBInstance
    Properties:
      AllocatedStorage: 100
      AllowMajorVersionUpgrade: False
      AutoMinorVersionUpgrade: False
      AvailabilityZone: us-east-1b
      DBInstanceClass: db.t2.micro
      DBName: lawndb
      StorageType: gp2 # aka SSD general purpose
      DBInstanceIdentifier: lawnDB
      DBSubnetGroupName:
        Fn::ImportValue: lawnDBsubnetGroup
      MasterUsername: lawn_admin # Ultimately safeguarded by SG
      MasterUserPassword: lawn_password # Ultimately safeguarded by SG
      PubliclyAccessible: True
      Port: 6543 # Slightly non-default postgreSQL port
      Engine: postgres
      VPCSecurityGroups:
        - Fn::ImportValue: lawnDBgroup # Doesn't touch the web

Outputs:
  lawnDB:
    Description: A reference to the RDS DB hostname
    Value: !GetAtt lawnDB.Endpoint.Address
    Export:
      Name: lawnDB
